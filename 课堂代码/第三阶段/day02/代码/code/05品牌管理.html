<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>品牌管理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        h3 {
            text-align: center;
            line-height: 50px;
            background-color: greenyellow;
        }

        .content {
            background-color: lightblue;
        }

        form {
            padding: 20px 0;
            text-align: center;
        }

        form input {
            border: none;
            outline: none;
            padding: 6px;
            border-radius: 8px;
            background-color: #fff;
        }

        form label {
            margin-left: 20px;
        }

        table th {
            height: 40px;
        }

        table td {
            height: 40px;
            text-align: center;
        }

        .mask {
            width: 100%;
            height: 100%;
            background-color: rgb(0, 0, 0, 0.3);
            position: fixed;
            left: 0;
            top: 0;
        }

        .mask .model {
            width: 300px;
            height: 200px;
            background-color: lightcoral;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 10px;
        }

        .toast {
            padding: 20px;
            background-color: lightgreen;
            border-radius: 8px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>
    <div id="app">
        <h3>品牌管理</h3>
        <div class="content">
            <form>
                <label>ID:</label><input type="text" v-model="id" />
                <label>Name: </label><input type="text" v-model="name" />
                <label>Status: </label><input type="text" v-model="status" />
                <input type="button" value="添加" @click="add" />
                <label>输入Name: </label><input type="text" v-model="keyword" />
            </form>
            <table width="100%" border="1" borderColor="orange" cellpadding="0" cellspacing="0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Ctime</th>
                        <th>Operation</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 之前， v-for 中的数据，都是直接从 data 上的list中直接渲染过来的 -->
                    <!-- 现在， 我们自定义了一个 search 方法，同时，把 所有的关键字，通过传参的形式，传递给了 search 方法 -->
                    <!-- 在 search 方法内部，通过 执行 for 循环， 把所有符合 搜索关键字的数据，保存到 一个新数组中，返回 -->
                    <tr v-for="item in search(keyword)" :key="item.id">
                        <td @mouseover="over(item)" @mouseout="out">{{ item.id }}</td>
                        <td>{{ item.name }}</td>

                        <td v-if="item.status == 0">未出库</td>
                        <td v-else-if="item.status == 1">已出库</td>
                        <td v-else-if="item.status == 2">已成交</td>
                        <td v-else>您胡输入呢！</td>

                        <td>{{ item.ctime | dateFormat }}</td>
                        <td><a href="#" @click="edit(item)">修改</a> | <a href="#" @click="del(item.id)">删除</a></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="mask" v-show="maskBoolean" style="display: none;">
            <div class="model">
                <form>
                    <label>Name: </label><input type="text" v-model="model.name" /><br /><br />
                    <label>Status: </label><input type="text" v-model="model.status" /><br /><br />
                    <input type="button" value="修改提交" @click="editSubmit" />
                </form>
            </div>
        </div>
        <div class="toast" v-show="toastBoolean" style="display: none;">
            {{ toast }}
        </div>
    </div>
</body>

</html>
<script src="./lib/vue-2.4.0.js"></script>
<script>
    //全局过滤时间日期格式
    //padStart(maxlength, str) 根据位数填充字符串
    // Vue.filter("dateFormat", function(dateStr) {
    //     console.log(dateStr)
    //     //根据给定的字符串，得到特定时间
    //     var dt = new Date(dateStr);
    //    //获取年
    //    var y = dt.getFullYear();
    //    //获取月
    //    var m = (dt.getMonth() + 1).toString().padStart(2, "0");
    //    //获取日
    //    var d = dt.getDate().toString().padStart(2, "0");
    //    //获取时
    //    var hh = dt.getHours().toString().padStart(2, "0");
    //    //获取分
    //    var mm = dt.getMinutes().toString().padStart(2, "0");
    //    //获取秒
    //    var ss = dt.getSeconds().toString().padStart(2, "0");

    //    return `${y} - ${m} - ${d}  ${hh} : ${mm} : ${ss}`;

    // })

    var vm = new Vue({
        el: "#app",
        data: {
            id: "",
            name: "",
            status: "",
            keyword: "",
            list: [{
                id: 1,
                name: "宝马",
                status: 0,
                ctime: new Date()
            },
            {
                id: 2,
                name: "奔驰",
                status: 1,
                ctime: new Date()
            },
            {
                id: 3,
                name: "奥迪",
                status: 2,
                ctime: new Date()
            }
            ],
            maskBoolean: null,
            model: {
                name: "",
                status: ""
            },
            toast: "",
            toastBoolean: null
        },
        methods: {
            //添加品牌
            add() {
                // 分析：
                // 1. 获取到 id 和 name ,直接从 data 上面获取 
                // 2. 组织出一个对象
                // 3. 把这个对象，调用 数组的 相关方法，添加到 当前 data 上的 list 中
                // 4. 注意：在Vue中，已经实现了数据的双向绑定，每当我们修改了 data 中的数据，Vue会默认监听到数据的改动，自动把最新的数据，应用到页面上；
                // 5. 当我们意识到上面的第四步的时候，就证明大家已经入门Vue了，我们更多的是在进行 VM中 Model 数据的操作，同时，在操作Model数据的时候，指定的业务逻辑操作；
                if (this.id && this.name && this.status) {
                    this.list.push({
                        id: this.id,
                        name: this.name,
                        status: this.status,
                        ctime: new Date()
                    })
                }
            },
            //模糊查询
            search(keyword) {
                console.log(keyword)
                //     var arr = [];
                //     this.list.forEach((item) => {

                //         if(item.name.indexOf(this.keyword) != -1){
                //             arr.push(item)
                //         }
                //     })
                //    return arr;

                //filter过滤数组
                // 注意 ： ES6中，为字符串提供了一个新方法，叫做includes('要包含的字符串')
                //  如果包含，则返回 true ，否则返回 false
                return this.list.filter((item) => {
                    if (item.name.includes(keyword)) {
                        return item;
                    }
                })
            },
            //删除方法
            del(id) {
                // 分析：
                // 1. 如何根据Id，找到要删除这一项的索引
                // 2. 如果找到索引了，直接调用 数组的 splice 方法
                console.log(id)
                this.list.forEach((item, index) => {
                    if (id == item.id) {
                        this.list.splice(index, 1);
                    }
                })
            },
            //修改方法
            edit(obj) {
                console.log(obj);
                this.maskBoolean = true;
                this.model = obj;
            },
            //修改提交
            editSubmit() {
                this.list.forEach((item) => {
                    if (this.model.id == item.id) {
                        item = this.model;
                    }
                })
                this.maskBoolean = false;
            },
            //划过
            over(obj) {

                var str = ""
                if (obj.status == 0) {
                    str = "未出库"
                } else if (obj.status == 1) {
                    str = "已出库"
                } else if (obj.status == 2) {
                    str = "已成交"
                } else {
                    str = "胡输入呢"
                }
                this.toastBoolean = true
                this.toast = obj.id + "-" + obj.name + "-" + str;
            },
            //离开
            out() {
                this.toastBoolean = false
            }


        },
        //私有过滤方法
        filters: {
            dateFormat: function (dateStr) {
                //根据给定的字符串，得到特定时间
                var dt = new Date(dateStr);
                //获取年
                var y = dt.getFullYear();
                //获取月
                var m = (dt.getMonth() + 1).toString().padStart(2, "0");
                //获取日
                var d = dt.getDate().toString().padStart(2, "0");
                //获取时
                var hh = dt.getHours().toString().padStart(2, "0");
                //获取分
                var mm = dt.getMinutes().toString().padStart(2, "0");
                //获取秒
                var ss = dt.getSeconds().toString().padStart(2, "0");

                return `${y} - ${m} - ${d}  ${hh} : ${mm} : ${ss}`;

            }
        }
    })
</script>