(function(){var Tools={getRandom:function(min,max){return Math.floor(Math.random()*(max-min))+min}};window.Tools=Tools})();(function(){var elements=[];function Food(options){options=options||{};this.x=options.x||0;this.y=options.y||0;this.width=options.width||20;this.height=options.height||20;this.color=options.color||"red"}Food.prototype.render=function(map){removeFood();this.x=Tools.getRandom(0,map.offsetWidth/this.width)*this.width;this.y=Tools.getRandom(0,map.offsetHeight/this.height)*this.height;var divDom=document.createElement("div");map.appendChild(divDom);elements.push(divDom);console.log(elements);divDom.style.position="absolute";divDom.style.left=this.x+"px";divDom.style.top=this.y+"px";divDom.style.width=this.width+"px";divDom.style.height=this.height+"px";divDom.style.backgroundColor=this.color};function removeFood(){console.log(elements);for(var i=elements.length-1;i>=0;i--){elements[i].parentNode.removeChild(elements[i]);elements.splice(i,1)}}window.Food=Food})();var elements=[];(function(){function Snake(options){options=options||{};this.width=options.width||20;this.height=options.height||20;this.direction=options.direction||"right";this.body=[{x:3,y:2,color:"red"},{x:2,y:2,color:"blue"},{x:1,y:2,color:"blue"}]}Snake.prototype.render=function(map){removeElement();for(var i=0;i<this.body.length;i++){var object=this.body[i];var divDom=document.createElement("div");map.appendChild(divDom);elements.push(divDom);divDom.style.position="absolute";divDom.style.width=this.width+"px";divDom.style.height=this.height+"px";divDom.style.left=object.x*this.width+"px";divDom.style.top=object.y*this.height+"px";divDom.style.backgroundColor=object.color}};Snake.prototype.move=function(food,map){for(var i=this.body.length-1;i>0;i--){this.body[i].x=this.body[i-1].x;this.body[i].y=this.body[i-1].y}var head=this.body[0];switch(this.direction){case"right":head.x+=1;break;case"left":head.x-=1;break;case"top":head.y-=1;break;case"bottom":head.y+=1;break}var headX=head.x*this.width;var headY=head.y*this.height;if(headX==food.x&&headY==food.y){var last=this.body[this.body.length-1];this.body.push({x:last.x,y:last.y,color:last.color});food.render(map)}};function removeElement(){for(var i=elements.length-1;i>=0;i--){elements[i].parentNode.removeChild(elements[i]);elements.splice(i,1)}}window.Snake=Snake})();(function(){var that;function Game(map){this.food=new Food();this.snake=new Snake();this.map=map;that=this;this.start()}Game.prototype.start=function(){this.food.render(this.map);this.snake.render(this.map);runSnack();bindKey()};function runSnack(){var myTimer=setInterval(function(){this.snake.move(this.food,this.map);this.snake.render(this.map);var headX=this.snake.body[0].x;var headY=this.snake.body[0].y;var maxX=this.map.offsetWidth/this.snake.width;var maxY=this.map.offsetHeight/this.snake.width;if(headX<0||headX>=maxX){clearInterval(myTimer);if(confirm("Game Over，是否重新开始游戏")){window.location.reload()}}if(headY<0||headY>=maxY){clearInterval(myTimer);if(confirm("Game Over，是否重新开始游戏")){window.location.reload()}}}.bind(that),200)}function bindKey(){document.onkeydown=function(event){var e=event||window.event;console.log(e.keyCode);switch(e.keyCode){case 37:this.snake.direction="left";break;case 38:this.snake.direction="top";break;case 39:this.snake.direction="right";break;case 40:this.snake.direction="bottom";break}}.bind(that)}window.Game=Game})();(function(){var map=document.getElementById("map");var game=new Game(map)})();